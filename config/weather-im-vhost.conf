<VirtualHost *:80>
  ServerName iembot
  DocumentRoot /mesonet/www/apps/weather.im/html
  CustomLog /mesonet/www/logs/access_log-iembot combined
  ServerAdmin akrherz@iastate.edu
  
  ProxyPass /iembot-json http://iembot:9003
  ProxyPass /iembot-rss http://iembot:9004  
</VirtualHost>

<VirtualHost *:80>
  ServerName weather.im
  ServerAlias www.weather.im

  Redirect permanent / https://weather.im/
</VirtualHost>

<VirtualHost _default_:443>
  ServerName weather.im
  ServerAlias www.weather.im
  SSLEngine on
  SSLProtocol all -SSLv2 -SSLv3
  SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
  SSLCertificateKeyFile /etc/letsencrypt/live/weather.im/privkey.pem
  SSLCertificateChainFile /etc/letsencrypt/live/weather.im/chain.pem
  SSLCertificateFile /etc/letsencrypt/live/weather.im/cert.pem

  # Use a daily deadicated log file, this avoids server reloads every day
  # which are not much fun when servicing a 1,000 req/sec
  CustomLog "|/usr/sbin/rotatelogs -l /mesonet/www/logs/weatherim-%Y%m%d 86400" combined
  DocumentRoot /mesonet/www/apps/weather.im/html
  ServerAdmin akrherz@iastate.edu
  Alias /usage/ "/mesonet/share/usage/weather.im/"
  <Directory "/mesonet/www/apps/weather.im/html">
    Options Indexes MultiViews FollowSymLinks
    AllowOverride All
  </Directory>
  
  # BOSH
  ProxyPass /http-bind http://openfire-bosh:7070/http-bind
  ProxyPass /bosh http://openfire-bosh:7070/http-bind
  ProxyPass /iembot-json http://iembot:9003
  ProxyPass /iembot-rss http://iembot:9004
  
  # hacky means to keep browsers from caching important javascript
  RewriteEngine On
  RewriteRule ^/live/100/([0-9]+)\.js /live/live.js [L]
  RewriteRule ^/live/101/([0-9]+)\.js /live/js/MapPanel.js [L]

  # Since RHEL Apache does not log 404s, sigh
  ErrorDocument 404 /error404.php
</VirtualHost>
